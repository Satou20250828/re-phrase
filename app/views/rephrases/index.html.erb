<header class="sticky top-0 z-50 w-full bg-white/80 backdrop-blur-md border-b border-primary/10 px-6 py-3 flex items-center justify-between">
  <div class="flex items-center gap-2">
    <div class="w-10 h-10 bg-gradient-to-br from-primary to-blue-700 rounded-lg flex items-center justify-center text-white shadow-sm">
      <span class="material-icons">auto_awesome</span>
    </div>
    <h1 class="text-xl font-bold tracking-tight text-slate-900">
      Re:<span class="text-primary">フレーズ</span>
    </h1>
  </div>
</header>

<main class="max-w-4xl mx-auto p-4 sm:p-6 space-y-6">
  <div id="form_errors">
    <%= render "rephrases/form_errors", error_message: @error_message, field_errors: @field_errors %>
  </div>

  <%= form_with url: rephrases_path, method: :post, scope: :rephrase, class: "space-y-6", data: { controller: "rephrase" } do |form| %>
    <section class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden focus-within:ring-2 focus-within:ring-primary/20 transition-all">
      <div class="p-1 flex justify-end bg-slate-50/50 border-b border-slate-100">
        <button type="button" class="flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-slate-500 hover:text-red-500 transition-colors" data-action="rephrase#clearContent">
          <span class="material-icons text-sm">delete_sweep</span>
          内容をクリア
        </button>
      </div>

      <%= form.text_area :content, rows: 6, class: "w-full p-6 border-none focus:ring-0 bg-transparent text-lg resize-none min-h-[160px] placeholder:text-slate-300", placeholder: "ここに言い換えたい文章を入力してください...", data: { rephrase_target: "content" } %>
    </section>

    <section class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
      <div class="flex items-center gap-2 mb-5">
        <span class="material-icons text-primary text-xl">tune</span>
        <h2 class="text-sm font-bold text-slate-700 uppercase tracking-wider">状況設定</h2>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <%= form.label :scene, "シーン", class: "block text-xs font-bold text-slate-500 mb-1.5 ml-1" %>
          <%= form.select :scene,
                          [["職場", "職場"], ["顧客対応・接客", "顧客対応・接客"], ["メール・チャット", "メール・チャット"], ["家族", "家族"], ["友人・知人", "友人・知人"], ["学校", "学校"], ["サービス利用", "サービス利用"], ["その他", "その他"]],
                          { include_blank: "選択してください" },
                          class: "w-full bg-slate-50 border-slate-200 rounded-xl text-sm focus:ring-primary focus:border-primary" %>
        </div>
        <div>
          <%= form.label :target, "相手の関係性", class: "block text-xs font-bold text-slate-500 mb-1.5 ml-1" %>
          <%= form.select :target,
                          [["目上", "目上"], ["同僚・同じ立場", "同僚・同じ立場"], ["目下", "目下"], ["不特定（顧客など）", "不特定（顧客など）"], ["その他", "その他"]],
                          { include_blank: "選択してください" },
                          class: "w-full bg-slate-50 border-slate-200 rounded-xl text-sm focus:ring-primary focus:border-primary" %>
        </div>
        <div>
          <%= form.label :context, "状況", class: "block text-xs font-bold text-slate-500 mb-1.5 ml-1" %>
          <%= form.select :context,
                          [["報告", "報告"], ["相談", "相談"], ["依頼", "依頼"], ["断り", "断り"], ["お詫び", "お詫び"], ["指摘", "指摘"], ["催促", "催促"], ["その他", "その他"]],
                          { include_blank: "選択してください" },
                          class: "w-full bg-slate-50 border-slate-200 rounded-xl text-sm focus:ring-primary focus:border-primary" %>
        </div>
      </div>
    </section>

    <div class="flex justify-center">
      <%= form.submit "言い換え実行", class: "group relative w-full sm:w-80 h-14 bg-primary hover:bg-blue-700 text-white rounded-full font-bold shadow-xl shadow-blue-500/20 flex items-center justify-center gap-3 transition-all active:scale-95 overflow-hidden" %>
    </div>
  <% end %>

  <%= turbo_frame_tag "rephrase_result" do %>
    <%= render partial: "rephrase_result", locals: { rephrased_results: @rephrased_results } %>
  <% end %>

  <footer class="pt-6 pb-16">
    <details class="group bg-slate-50 rounded-2xl border border-slate-200 overflow-hidden" open>
      <summary class="flex items-center justify-between p-4 cursor-pointer hover:bg-slate-100 transition-colors list-none">
        <div class="flex items-center gap-3">
          <span class="material-icons text-slate-400">history</span>
          <span class="text-sm font-bold text-slate-600">履歴</span>
          <span class="text-[10px] bg-slate-200 text-slate-500 px-2 py-0.5 rounded-full"><%= @search_logs.size %></span>
        </div>
      </summary>
      <div id="history_list" data-controller="history" class="p-4 space-y-3 border-t border-slate-200 max-h-80 overflow-y-auto">
        <% @search_logs.each do |search_log| %>
          <%= render "history_item", search_log: search_log %>
        <% end %>
      </div>
    </details>
  </footer>
</main>
